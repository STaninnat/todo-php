services:
  php-fpm:
    build: .
    container_name: php_fpm_test
    env_file:
      - .env.test
    volumes:
      - ./src:/app/src
      - ./public:/app/public
      - ./vendor:/app/vendor
    environment:
      APP_ENV: ${APP_ENV:-testing}
      APP_DEBUG: ${APP_DEBUG:-true}
    depends_on:
      - db_test
    networks:
      - app_network
    profiles: ["test"]

  db_test:
    image: bitnami/mysql:8.0
    container_name: mysql_db_test
    env_file:
      - .env.test
    ports:
      - "3307:3306"
    volumes:
      - db_test_data:/bitnami/mysql
    networks:
      - app_network
    profiles: ["test"]

volumes:
  db_test_data:

networks:
  app_network:
